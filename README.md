



基于DIA图谱分解的肽段定量分析软件V1.0




用户手册

















目录
1引言	3
1.1编写目的	3
1.2项目背景	3
1.3定义	4
2软件概述	5
2.1目标	5
2.2功能	5
2.3性能要求	5
2.3.1用户输入要求	5
2.3.2时间特性要求	5
3运行环境	6
3.1硬件	6
3.2支持软件	6
4使用说明	6
4.1安装与初始化	6
4.2输入	7
4.2.1输入要求	7
4.2.2输入举例	7
4.3输出	8
4.4出错和恢复	8
4.5系统工作流	8
5运行说明	9
5.1运行表	9
5.2运行步骤	9
5.2.1创建任务	9
5.2.2执行任务	11
5.2.3结果下载	12
5.2.4查看教程	12
5.2.5联系我们	13
6用户操作举例	13
6.1数据准备	13
6.2创建任务	14
6.3执行任务	15
6.4结果下载	16



 
1引言
1.1编写目的
本用户手册面向的用户主体是研究定量蛋白质组学相关方向的科研人员，主要目的是详细说明本软件所实现的功能及其运行方式，以便使用者了解本软件的适用场景和使用方法。
1.2项目背景
蛋白质是生命体的直接生物功能分子，为生命活动提供物质基础，因此对蛋白质的研究能够帮助人们探索各种生命活动机理，为生物学与医学研究作出重要贡献。蛋白质组的概念于 20 世纪末期被首次提出，指在生物组织或生物学环境中产生的一组蛋白质。继而衍生出对蛋白质组实验进行系统性大规模分析的蛋白质组学 (proteomics)，主要应用于癌症研究、药物和药物靶标发现、蛋白质间的相互作用以及发现生物标志物和阐明疾病机理，为直接在蛋白质水平上对基因和细胞功能进行大规模研究提供有力支撑。
蛋白质组学的进步是生物分子分离技术、质谱 (mass spectrometry, MS) 以及生物信息学分析等领域共同推动的结果，其中质谱技术在蛋白质组学中起着举足轻重的作用。早期质谱技术通常用于鉴定生物系统中的蛋白质及其水解产生的肽段。随着质谱仪器精度逐渐提高以及定性分析方法的日趋完善，对于生物样本的大规模蛋白质定量需求日益增加，对蛋白质和肽段的定量分析逐渐受到广泛关注，从而催生出定量蛋白质组学 (quantitative proteomics)。定量蛋白质组学不仅要鉴定存在于样本中的蛋白质，还要准确评估蛋白质的丰度。相比于传统的双向电泳，质谱技术具有更高的灵敏度和分辨率，因此逐渐成为定量蛋白质组学研究的主要手段。
自下而上的蛋白质组学 (bottom­up proteomics) 是当前主流的工作流程，通过分析蛋白质水解的肽段来测量蛋白质，主要包括以下步骤：（1）从生物样品中分离蛋白质混合物；（2）使用特定的蛋白酶将蛋白质水解为肽段；（3）通过质谱仪采集肽段样本的质谱数据；（4）对肽段进行定性、定量分析；（5）对蛋白质进行定性、定量分析。自下而上的蛋白质组学利用了肽段相对于蛋白质的优势，即肽段信息更容易被质谱仪采集，从而可以进行高通量分析，从复杂裂解物中鉴定和定量数千种蛋白质。
1.3研究现状
由于生物系统的复杂性，现阶段蛋白质组学实验在质谱采集之前通常要进行充分洗脱，并且对于复杂样品，早期的质谱模式鉴定同源蛋白质的能力不足，这些推动了液相色谱­串联质谱 (liquid chromatography­tandem mass spectrometry, LCMS/MS) 技术的迅速发展。在基于 LC­MS/MS 的蛋白质组学实验中，蛋白质样品通过水解转化为肽段，然后经过液相色谱洗脱和离子化，肽段母离子以不同的时间进入质量分析器并进行串联质谱分析。串联质谱是目前高通量蛋白质分析的主要技术，由一级质谱和二级质谱交替进行，其中一级质谱采集母离子信号形成一级质谱图 (MS1)，二级质谱根据一定策略从一级质谱中选择部分母离子进行碎裂，并采集相应的碎片离子信号形成二级质谱图 (MS2)。
由于共洗脱的特点，LC-MS/MS 图谱极易生成混合图谱（chimeric spectra），混合图谱是由至少两种肽段母离子共碎裂后形成的二级质谱图，通常被认为是对蛋白质组学研究的一个限制，因为它降低了图谱库 (spectral library) 搜索模型的鉴定性能，其中图谱库是存储单一肽段母离子碎裂产生的参考图谱的数据库。混合图谱分解的目标是从混合图谱中鉴定其肽段组成以及确定各肽段对混合图谱的贡献。由于近年来对面向 DIA质谱数据的定量方法研究逐渐增加，而 DIA 图谱通常为混合图谱，因此混合图谱分解问题的重要性逐渐得以凸显。针对图谱分解问题，目前虽然已经提出了多种策略与算法，但其准确度与效率仍存在较大的提升空间，这给肽段的定性及定量分析带来了巨大挑战。
1.4项目简介
为了更好地求解图谱分解问题，我们设计并实现了一种基于特征离子的DIA图谱分解算法Fisdec (featured ions-based spectral deconvolution)，与现有的基于全离子峰拟合的图谱分解方法相比，Fisdec在准确度和效率上均有了大幅提升。在Fisdec算法的基础上，我们设计研发了一个基于DIA图谱分解的肽段定量分析软件FIGS (featured-­ions guided stoichiometry)。FIGS 以质谱数据和图谱库数据作为输入，在程序运行完毕后，就可以输出得到相应的肽段定量结果文件。该软件大大简化了定量蛋白质组学相关方向科研人员的工作量，为定量蛋白质组学领域提供了一个有效的计算工具，促进了该领域的发展。FIGS的主要流程如下图所示：

 
2实验环境与环境配置
2.1硬件环境
开发环境：PC，Intel(R) Core(TM) i7-7700K CPU @4.20GHz，16G内存。
运行环境：最低1GHz CPU，推荐2.5GHz及以上；最低1G内存，推荐2G内存及以上。
2.2软件环境
开发环境：Windows 10, Microsoft Visual Studio 2015开发平台。
运行环境：Windows 7及以上，Apache 2.4，MongoDB 4.2。
2.3环境配置
首先下载代码。
代码包括以下几个文件：
requirements_conda.txt	--python3.6.5环境以及库
requirements_R.txt		    --R语言环境所需库（3.6.x版本）

FIGS_Deconvolute.py		--FIGS解谱，python程序
myms.py					
sparse_nnls.py			
FIGS_Quant.R				--FIGS进行定量，R语言程序

FIGS.py					--FIGS界面程序，实现了，解谱时多个文件同时计算，以及定量时多个文件同时计算
下面开始进行环境配置：
1.	先配置好python语言环境，利用pip或者anaconda配置python3.6.5环境以及需要的库（库的名称与版本号详见requirements_conda.txt）。
2.	之后配置R语言环境，如果没有安装R软件，需要进入R的官网（https://www.r-project.org/）点击dowmload R，之后根据操作系统选择相应的R软件进行安装。在安装完毕后，在R的控制台,输入install.packages("xxx")命令对所需要的库进行安装，其中xxx表示所要安装的库的名称（需要用到的库的名称详见requirements_R.txt）。
3.	为了利用python中的rpy2库来让python调用R语言程序，需要配置环境变量。需要配置R_HOME为R语言安装路径，如 E:\Software\R。配置R_USER为rpy2安装路径，如E:\Software\Anaconda3\envs\py36\Lib\site-packages\rpy2。
3软件界面
3.1运行程序 
在配置完环境后，在Windows下使用CMD进入代码所在目录，执行python FIGS.py命令即可进入软件界面。软件界面如下图所示，主要分为三个部分：左上方的文件输入模块、左下方的参数模块、以及右边的运行和日志输出模块，下面对这三个模块进行逐一地介绍。
 
3.2文件输入模块
本模块用来输入质谱数据和库文件。对应上图序号1-5。
①点击“Add data”添加质谱文件，可以一次选择多个质谱文件作为输入。这里质谱数据文件必须为“.mzML”格式的文件。
②如果想删除已经添加的质谱文件，点击“Clear data”可以清除所有已选择的质谱数据文件。
③显示已经添加的质谱数据文件。
④点击“Add library”添加质谱数据对应的库文件，只能添加一个库文件作为输入。这里库文件必须为“.blib”格式的文件。
⑤显示已经添加的库文件。
3.3参数模块
本模块用来输入进行计算的参数。每个参数都设置了默认值，可以手动更改。对应上图序号6-10。
⑥“PPM”，(parts-per-million)，仪器的质量精度，以百万分之一为单位，默认为20，需要为整数。
⑦“FDR”，(False Discovery Rate)，默认为0.01，范围为大于0小于1的小数。
⑧“Decoration type”，修饰类型。Default(默认)，暂时不能修改。
⑨“Featured-ions”，特征离子。Default(默认)：使用所有特征离子。或者Top10-first：优先使用属于相应光谱库中强度最高的十个离子作为特征离子来计算系数。 当光谱库中没有满足此条件的特征离子时，将使用默认策略。
⑩“MS data type”，质谱数据类型。默认为DIA数据，RT-free暂时未集成。
3.4运行模块
本模块用来进行计算的控制和日志的输出。对应上图序号11-13。
⑪当质谱数据和库文件按要求选择完成，以及参数输入完成后，点击“Run”即可进行计算。
⑫若需要终止当前正在进行的计算，点击“Stop”即可终止。如果想修改参数或者修改计算的文件等，也需要先终止正在执行的计算才能进行新的计算。
⑬这里会显示一些提示信息，如未选择文件、文件格式不正确等。还会输出当前计算的日志，如已经完成的计算、计算进行到哪一步了、计算开始的时间、计算结束的时间等。同时会把计算过程中的关键信息保存到log.txt文件中。
4.2.1输入要求
用户在新建任务和下载结果时需要进行输入，输入参数要求如下表。
场景	参数名	参数描述	参数来源	默认值	是否必填	其他要求
新建任务	任务名	任务的唯一标识	手工输入	无	是	参数不能与已有任务名重复
	任务描述	对任务内容的描述	手工输入	无	是	
	邮箱地址	联系邮箱，用于接收任务执行结果的通知	手工输入	无	是	
	模型名	使用的全基因组代谢网络模型	下拉选择	无	是	
	Tumor.csv	癌细胞基因表达数据文件名	手工输入	Tumor.csv	是	参数内容与癌细胞数据文件名一致
	Normal.csv	正常细胞基因表达数据文件名	手工输入	Normal.csv	是	
	癌细胞数据	癌细胞基因表达数据文件	文件上传	无	是	对数处理的读计数类型RNA-seq数据，文件格式为csv
	正常细胞数据	正常细胞基因表达数据文件	文件上传	无	是	
结果下载	任务名	任务的唯一标识	手工输入	无	是	参数对应的任务必须存在且已经执行成功
4.2.2输入举例
场景	参数名	参数值
新建任务	任务名	task1
	任务描述	分析肺癌的潜在靶点和可用药物
	邮箱地址	cmadptest@qq.com
	模型名	Recon3D
	Tumor.csv	t.csv
	Normal.csv	n.csv
	癌细胞数据	文件，文件名为t.csv
	正常细胞数据	文件，文件名未n.csv
结果下载	任务名	task1
4.3输出
任务执行完成后的结果作为输出被下载，各项输出描述如下。
参数名	参数描述	参数类型	文件名
差异上调基因	癌细胞中表达水平显著高于正常细胞的基因	txt文件	all_RNA-seq_up.txt
上调代谢基因	与代谢相关的差异上调基因	txt文件	Gene_up.txt
代谢网络模型	生成的环境特异性代谢网络模型	mat文件	Cancer_Model.mat
必要基因	对特异性代谢网络敲除致死的基因	txt文件	ess_gene_name.txt
潜在靶点	对正常细胞无毒性的必要基因	txt文件	Drug_Target.txt
关联药物	知识库中与潜在靶点关联的药物	txt文件	Drug_Smiles.txt
有效药物	被预测为对治疗癌症有效的关联药物	txt文件	Effective_Drug.txt
4.4出错和恢复
出错信息	含义	解决策略
30001: Task Already Exists	当前创建的任务与已有任务重名	修改任务名
2005: File Not Found	目标文件不存在	重新上传文件
5002: Upload Failed	文件上传失败	尝试重新上传文件
30004: Task Not Exists	目标任务不存在	修改为正确的任务名
5003: File Name Is Empty	文件名参数为空	填写正确的文件名
如果仍然有问题，请点击 Contact us 页面，向我们的联系邮箱发送邮件。
4.5系统工作流
 
5运行说明
5.1运行表
平台运行表如下。
运行情况	运行目的
创建任务	创建一个新的执行任务，并按照要求上传对应文件数据
执行任务	执行目标任务，可以是自己创建的，也可以是他人创建的，平台进行自动化数据分析以获得目标结果
结果下载	对指定的已经执行成功的任务，下载其结果以便进行后续的分析
查看教程	了解平台的相关信息及操作指南
联系我们	与开发人员联系，反馈问题
5.2运行步骤
5.2.1创建任务
点击左侧工具栏“Add task”进入任务添加页面，如图所示。
 
按照要求输入任务名称、任务描述、联系邮箱，并在下拉框中选择要使用的代谢网络模型（目前提供了Recon3D和HMR2供选择），选择之后，网页会给出模型要求的输入参数和生成的输出参数列表，其中param type代表参数类型，file表示参数为文件，param value代表参数名称（文件名称），param description代表参数的描述，负责说明该参数的主要功能以及表现形式等，如图所示。
 
按照模型的输入参数要求，点击Select Files按钮上传对应的数据文件，点击Upload进行上传，上传的文件名称应该和输入参数列表中的param value值保持一致，也可以修改param value使其与对应的参数文件名称保持一致。上传成功后，网页右上角会弹出提示，如图所示。
 
最后，点击页面底部的Upload Task按钮进行任务的添加，或者点击Cancel Upload取消添加。任务添加成功后，会在网页右上角弹出提示，如图所示。
 
若任务上传失败，会弹出提示并说明原因（如任务已存在），如图8所示，需要修改部分输入参数后再次上传。
 
5.2.2执行任务
点击左侧工具栏“Run task”按钮可进入任务执行页面，如图所示。
 
页面给出当前数据库中存在的所有任务，包含任务名、任务描述、使用的模型、任务状态等信息，其中任务状态分为ready（已创建未执行）、executing（正在执行）、failed（执行失败）、success（执行成功）四种类型，用户可以通过点击对应任务右侧的“execute”按钮执行对应的任务。
若任务此时的状态为success，说明该任务已经执行成功，无需重新执行，网页会给出对应的提示，如图所示。
 
若任务此时的状态为executing，说明当前任务正在执行中，也无需重新执行，网页会给出对应的提示，如图所示。
 
若任务状态为ready或failed，说明当前任务未执行或上次执行失败了，会给出提示如图所示。
 
用户点击“Yes”即可开始执行任务，并更新任务状态为executing，若点击“No”或关闭提示窗口则不会执行。
每个任务在创建时都会与对应的邮箱绑定，在任务执行结束后（无论成功还是失败），系统会自动向绑定邮箱发送一封邮件告知执行结果（成功/失败）。若成功，用户可以登录系统进行结果的下载；若失败，则可以再次执行或放弃执行。
5.2.3结果下载
点击左侧工具栏“Result”按钮可进入结果下载页面，如图所示。
 
在输入框内输入想要下载结果的任务名并点击搜索，可以得到对应任务的详细信息，结果页面给出该任务的任务名、ID、状态、创建时间、执行完成时间、描述等信息，如图所示。
 
点击“Download”，页面如图所示。
 
点击“Download Results”按钮即可将结果下载到本地，下载的文件列表是创建任务时所使用的模型的输出参数列表。
5.2.4查看教程
点击左侧工具栏“Tutorial”按钮即可进入教程页面，如图所示。该页面提供了关于网站使用的简单说明。
 
5.2.5联系我们
点击左侧工具栏“Contact us”进入联系我们页面，该页面提供了我们的联系方式，用户在使用网站时遇到问题可以通过这些方式联系到我们，页面如图所示。
 
6用户操作举例
在本节中，我们以一个实例说明平台的操作。
6.1数据准备
我们使用来自TCGA的基因表达数据，分为两个文件，一个保存癌症基因表达数据的Tumor.csv，一个保存正常细胞基因表达数据的Normal.csv，其数据形式为经过对数处理（log2(count+1)）的read count数据，如图所示。
 
6.2创建任务
我们打开创建任务页面，新建一个任务，任务名为“CMADP_test”，任务描述为“CMADP_test”，使用的全基因组代谢网络模型为“Recon3D”，并设置接收邮件的电子邮箱。两个输入文件的名称使用默认值，如图所示。
 
点击“Select Files”按钮上传6.1种准备好的数据文件，然后点击下方“Upload”进行上传，上传成功后的页面如图所示。
 
点击页面最下方“Upload Task”创建任务，创建成功后页面如图所示。
 
6.3执行任务
打开执行任务页面，找到刚刚创建的“CMADP_test”任务，如图所示。
 
任务状态为“ready”，可以执行，点击右侧“execute”按钮，弹出提示框。
 
点击“Yes”确认执行，任务状态变更为“executing”，如图所示。
 
6.4结果下载
任务执行成功后，会收到邮件通知如图。
 
打开结果下载页面，按照任务名搜索“CMADP_test”，如图所示。
 
点击“Download”→“Download Results”下载结果文件，文件列表如图。
 
